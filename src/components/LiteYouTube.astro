---
/* src/components/LiteYouTube.astro */
import '@/styles/components/liteyoutube.css';

interface Props {
  videoId: string;
  title: string;
  backgroundImage?: string;
}

const { videoId, title, backgroundImage } = Astro.props;

// 背景画像の決定ロジック
const posterUrl = backgroundImage 
    ? backgroundImage 
    : `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
---

<div class="video-wrapper">
    <div class="video-container" data-id={videoId} style={`background-image: url('${posterUrl}');`}>
        <div class="play-button" aria-label="Play Video">
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </div>
        
        <iframe 
            class="youtube-iframe"
            title={title}
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen
        ></iframe>
    </div>
</div>

<script>
    function initYouTube() {
        const containers = document.querySelectorAll('.video-container');
        containers.forEach(c => {
            // 型アーションを使用してHTMLElementとして扱う
            const container = c as HTMLElement;
            
            container.onclick = () => {
                const id = container.getAttribute('data-id');
                const iframe = container.querySelector('iframe');
                if (iframe && !iframe.src && id) {
                    iframe.src = `https://www.youtube.com/embed/${id}?autoplay=1&rel=0`;
                    container.classList.add('playing');
                }
            };
        });
    }
    // Astroのページ遷移に対応
    document.addEventListener('astro:page-load', initYouTube);
</script>