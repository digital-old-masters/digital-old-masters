---
/* src/components/ArticleCarousel.astro - Cloudinary Optimized v1.2 */
/* 1. 専用CSSのインポート */
import '../styles/components/carousel.css';
/* 2. 神経回路(Cloudinary)のインポート */
import { getCloudinaryUrl } from '@/lib/cloudinary';

interface Props {
  posts: any[];
  title?: string;
}

const { posts, title = "Latest Sketches" } = Astro.props;
const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<section class="carousel-section">
  {title && <h2>{title}</h2>}
  
  <div class="carousel-container">
    {posts.map((post, index) => {
      // 画像パスの取得
      const imagePath = post.frontmatter.image;
      
      // Cloudinary URL生成 (CSSの 320px/16:9 に合わせた2倍解像度)
      const optimizedImage = imagePath 
        ? getCloudinaryUrl(imagePath, { width: 640, height: 360 }) 
        : '';

      return (
        <article class="carousel-card">
           <div class="carousel-image">
              {optimizedImage && (
                /* 【修正】LCP最適化ロジックは死守 */
                <img 
                  src={optimizedImage} 
                  alt={post.frontmatter.title} 
                  width="320"
                  height="180"
                  loading={index === 0 ? "eager" : "lazy"}
                  fetchpriority={index === 0 ? "high" : "auto"}
                />
              )}
           </div>

           {/* コンテンツエリア */}
           <div class="carousel-content">
              <span class="carousel-date">{post.frontmatter.artDate}</span>
              <h3>{post.frontmatter.title}</h3>
              
              {/* 3. タグリンク (z-index: 2) */}
              <div class="carousel-tags">
                  {post.frontmatter.tags && post.frontmatter.tags.slice(0, 3).map((tag: string) => (
                      <a href={`${baseUrl}/tags/${tag}`} class="carousel-tag">
                          #{tag}
                      </a>
                  ))}
              </div>
           </div>

           {/* 4. メイン記事リンク (Overlay, z-index: 1) */}
           <a href={post.url} class="card-overlay-link" aria-label={`Read ${post.frontmatter.title}`}></a>
        </article>
      );
    })}
    
    <div class="carousel-spacer"></div>
  </div>
</section>