---
/* src/components/ArchiveSidebar.astro - Modernized */
import '../styles/layouts/archive.css';
/* 1. 浄水場への接続 */
import { getAllPosts } from '../lib/content';

/* 2. データの取得 (すでにソート済み・ID化済み) */
const allPosts = getAllPosts();

/* 3. 集計ロジック (変更なしだが、入力データが純水になった) */
const categories = [...new Set(allPosts.map((post) => post.frontmatter.category).filter(Boolean))].sort();
const tags = [...new Set(allPosts.flatMap((post) => post.frontmatter.tags || []))].sort();

const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<aside class="archive-sidebar">
    <section class="archive-section">
        <h2>Categories</h2>
        <ul class="category-list">
            {categories.map(category => (
                <li>
                    <a href={`${baseUrl}/category/${(category as string).toLowerCase()}`}>{category}</a>
                </li>
            ))}
        </ul>
    </section>

    <section class="archive-section">
        <h2>Concept Tags</h2>
        <div class="tag-cloud">
            {tags.map(tag => (
                <a href={`${baseUrl}/tags/${tag}`} class="tag-link">#{tag}</a>
            ))}
        </div>
    </section>
</aside>