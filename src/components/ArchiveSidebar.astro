---
/* src/components/ArchiveSidebar.astro */
/* アーカイブ、カテゴリー、タグページで共通使用するサイドバー */

/* 全記事を取得してタグとカテゴリーを抽出 */
/* 注: 相対パスはコンポーネントの位置(src/components)から見た src/pages/posts */
import '../styles/layouts/archive.css';
const allPosts = Object.values(import.meta.glob('../pages/posts/*.{md,mdx}', { eager: true }));

const categories = [...new Set(allPosts.map((post: any) => post.frontmatter.category).filter(Boolean))].sort();
const tags = [...new Set(allPosts.flatMap((post: any) => post.frontmatter.tags || []))].sort();

const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<aside class="archive-sidebar">
    <section class="archive-section">
        <h2>Categories</h2>
        <ul class="category-list">
            {categories.map(category => (
                <li>
                    <a href={`${baseUrl}/category/${(category as string).toLowerCase()}`}>{category}</a>
                </li>
            ))}
        </ul>
    </section>

    <section class="archive-section">
        <h2>Concept Tags</h2>
        <div class="tag-cloud">
            {tags.map(tag => (
                <a href={`${baseUrl}/tags/${tag}`} class="tag-link">#{tag}</a>
            ))}
        </div>
    </section>
</aside>