---
/* src/components/Header.astro - Config Powered */
import { SITE_METADATA, NAV_ITEMS } from '../config';

/* GitHub Pages用のベースパス処理 */
/* import.meta.env.BASE_URL は '/digital-old-masters/' になります */
const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, '');

/* リンク生成ヘルパー: 内部リンクにはBaseUrlを付与、アンカー(#)や外部リンクはそのまま */
const getPath = (href: string) => {
  if (href.startsWith('#') || href.startsWith('http')) return href;
  return baseUrl + href;
};
---

<header id="main-header">
  <div class="container">
    {/* タイトルをConfigから取得 (Brain) */}
    <a href={import.meta.env.BASE_URL} class="logo">{SITE_METADATA.title}</a>
    
    <nav class="desktop-nav">
      {/* ナビゲーションをConfigから取得 (Brain) */}
      {NAV_ITEMS.map(item => (
        <a 
            href={getPath(item.href)} 
            class={item.isIcon ? 'icon-link' : ''}
        >
          {item.label}
        </a>
      ))}
    </nav>

    <button id="menu-toggle" aria-label="Menu">
      <span class="bar"></span>
      <span class="bar"></span>
    </button>
  </div>

  <nav id="mobile-menu">
    {NAV_ITEMS.map(item => (
      <a href={getPath(item.href)}>{item.label}</a>
    ))}
  </nav>
</header>

<script>
  function initMenu() {
      const toggle = document.getElementById('menu-toggle');
      const menu = document.getElementById('mobile-menu');
      
      if(toggle && menu) {
          toggle.onclick = () => {
              menu.classList.toggle('active');
              toggle.classList.toggle('active');
          };

          menu.querySelectorAll('a').forEach(link => {
              link.onclick = () => {
                  menu.classList.remove('active');
                  toggle.classList.remove('active');
              };
          });
      }
  }
  /* View Transitionsに対応するため、ページ遷移後も実行 */
  document.addEventListener('astro:page-load', initMenu);
</script>

<style>
  /* デザイン（Skin）は変更なし */
  header { padding: 1.2rem 0; position: sticky; top: 0; background: var(--c-bg); z-index: 100; border-bottom: 1px solid transparent; transition: all 0.3s; }
  :global(body.scrolled) header { border-bottom-color: #E0Dbd0; background: rgba(249, 247, 241, 0.95); backdrop-filter: blur(5px); }
  .container { max-width: 900px; margin: 0 auto; padding: 0 1.5rem; display: flex; justify-content: space-between; align-items: center; }
  .logo { font-family: var(--font-serif); font-size: 1.3rem; letter-spacing: 0.05em; color: var(--c-text); font-weight: bold; }
  .desktop-nav { display: flex; gap: 1.8rem; align-items: center; }
  .desktop-nav a { color: #555; font-size: 0.95rem; letter-spacing: 0.03em; position: relative; }
  .desktop-nav a:not(.icon-link)::after { content: ''; position: absolute; width: 0; height: 1px; bottom: -4px; left: 0; background-color: var(--c-accent); transition: width 0.3s; }
  .desktop-nav a:not(.icon-link):hover::after { width: 100%; }
  .desktop-nav a.icon-link { font-size: 1.2rem; }
  #menu-toggle { display: none; background: none; border: none; cursor: pointer; flex-direction: column; gap: 5px; padding: 5px; }
  .bar { width: 22px; height: 2px; background-color: var(--c-text); transition: 0.3s; }
  #menu-toggle.active .bar:nth-child(1) { transform: translateY(7px) rotate(45deg); }
  #menu-toggle.active .bar:nth-child(2) { transform: translateY(-7px) rotate(-45deg); }
  #mobile-menu { display: none; flex-direction: column; padding: 1.5rem; border-top: 1px solid #E0Dbd0; background: var(--c-bg); position: absolute; top: 100%; left: 0; width: 100%; box-sizing: border-box; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
  #mobile-menu.active { display: flex; }
  #mobile-menu a { padding: 0.8rem 0; border-bottom: 1px solid #eee; color: #333; font-size: 1.1rem; text-align: center; }
  @media (max-width: 768px) { .desktop-nav { display: none; } #menu-toggle { display: flex; } }
</style>