---
import Layout from '../layouts/Layout.astro';
import LiteYouTube from '../components/LiteYouTube.astro';
import type { GetStaticPaths, Page } from 'astro';
import '../styles/global.css';

interface Props {
  page: Page<any>;
}

export const getStaticPaths = (async ({ paginate }) => {
  const allPosts = Object.values(import.meta.glob('./posts/*.md', { eager: true }))
    .sort((a: any, b: any) => new Date(b.frontmatter.artDate).getTime() - new Date(a.frontmatter.artDate).getTime());
  
  return paginate(allPosts, { pageSize: 9 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, '');
const isFirstPage = page.currentPage === 1;
---

<Layout title="Digital Old Masters" description="Archiving beauty into the semantic layer.">
	
    {isFirstPage && (
        <>
        <section class="hero">
            <h1>Digital Old Masters</h1>
            <p class="subtitle">Archiving beauty into the semantic layer.</p>
        </section>

        <section class="atelier">
            <h2>Atelier</h2>
            <LiteYouTube videoId="DYC-Vio6TlY" title="Drawing Process" />
            <p class="caption">Process: Layer 1 to Layer 2</p>
        </section>
        </>
    )}

	<section class="gallery">
		<h2>{isFirstPage ? 'Journal' : `Journal (Page ${page.currentPage})`}</h2>
		<div class="grid">
			{page.data.map((post: any) => (
				<a href={post.url} class="card">
					<article>
                        <div class="card-image">
                            {post.frontmatter.image && 
                            <img src={import.meta.env.BASE_URL + post.frontmatter.image} alt={post.frontmatter.title} loading="lazy" />
                            }
                        </div>
						<div class="content">
                            <div class="meta">
                                <span class="date">{post.frontmatter.artDate}</span>
                                {post.frontmatter.category && <span class="category-label">{post.frontmatter.category}</span>}
                            </div>
                            <h3>{post.frontmatter.title}</h3>
                            
                            <div class="tags">
                                {post.frontmatter.tags && post.frontmatter.tags.map((tag: string) => (
                                    <span class="tag">#{tag}</span>
                                ))}
                            </div>
                        </div>
					</article>
				</a>
			))}
		</div>
	</section>

    {page.lastPage > 1 && (
        <nav class="pagination">
            {page.url.prev ? (
                <a href={baseUrl + page.url.prev} class="prev">← Prev</a>
            ) : <span class="disabled">← Prev</span>}
            
            <span class="current">Page {page.currentPage} of {page.lastPage}</span>

            {page.url.next ? (
                <a href={baseUrl + page.url.next} class="next">Next →</a>
            ) : <span class="disabled">Next →</span>}
        </nav>
    )}

</Layout>